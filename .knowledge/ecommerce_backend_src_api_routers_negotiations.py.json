{"is_source_file": true, "format": "Python", "description": "This source file defines FastAPI router endpoints for managing negotiations related to offers in an e-commerce backend. It includes authentication, retrieval, and posting of negotiation messages and counter-offers, with associated data models and utility functions.", "external_files": ["src.core.security", "src.deps", "src.models", "src.models.enums", "src.schemas.negotiation"], "external_methods": ["decode_token", "db_session", "NegotiationRead.model_validate"], "published": ["get_negotiations_for_offer", "post_negotiation_for_offer"], "classes": [{"name": "_TokenUser", "description": "Internal helper schema to represent token-authenticated user identity for negotiations."}, {"name": "NegotiationPostPayload", "description": "Schema for payload to post into a negotiation thread, including message and optional counter offer."}], "methods": [{"name": "_TokenUser _auth_user(authorization: str | None = Header(default=None))", "description": "Extracts and validates the current user from the authorization header token.", "scope": "", "scopeKind": ""}, {"name": "tuple[Offer,Listing] _get_offer_and_listing(db: Session, offer_id: UUID)", "description": "Fetches Offer and Listing objects from the database by offer ID, raising 404 if not found.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_party(offer: Offer, listing: Listing, user_id: UUID)", "description": "Checks that the current user is a party to the offer or listing; raises 403 if not.", "scope": "", "scopeKind": ""}, {"name": "List[NegotiationRead] get_negotiations_for_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Retrieves negotiations associated with an offer if the requester is authorized.", "scope": "", "scopeKind": ""}, {"name": "NegotiationRead post_negotiation_for_offer( id: UUID, payload: NegotiationPostPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Creates or updates a negotiation message and/or counter-offer for a specific offer.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "db_session", "NegotiationRead.model_validate"], "search-terms": ["negotiations", "Offer", "Negotiation", "APIRouter", "post_negotiation", "get_negotiations"], "state": 2, "file_id": 41, "knowledge_revision": 103, "git_revision": "", "ctags": [{"_type": "tag", "name": "NegotiationPostPayload", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^class NegotiationPostPayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^def _auth_user(authorization: str | None = Header(default=None)) -> _TokenUser:$/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Header(default=None))"}, {"_type": "tag", "name": "_ensure_party", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^def _ensure_party(offer: Offer, listing: Listing, user_id: UUID) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(offer: Offer, listing: Listing, user_id: UUID)"}, {"_type": "tag", "name": "_get_offer_and_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^def _get_offer_and_listing(db: Session, offer_id: UUID) -> tuple[Offer, Listing]:$/", "language": "Python", "typeref": "typename:tuple[Offer,Listing]", "kind": "function", "signature": "(db: Session, offer_id: UUID)"}, {"_type": "tag", "name": "counter_amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^    counter_amount: Optional[float] = Field(default=None, description=\"Optional counter offer am/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "variable", "scope": "NegotiationPostPayload", "scopeKind": "class"}, {"_type": "tag", "name": "get_negotiations_for_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^def get_negotiations_for_offer($/", "language": "Python", "typeref": "typename:List[NegotiationRead]", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^    message: Optional[str] = Field(default=None, description=\"Message content\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "NegotiationPostPayload", "scopeKind": "class"}, {"_type": "tag", "name": "post_negotiation_for_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^def post_negotiation_for_offer($/", "language": "Python", "typeref": "typename:NegotiationRead", "kind": "function", "signature": "( id: UUID, payload: NegotiationPostPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/negotiations.py", "pattern": "/^router = APIRouter(prefix=\"\\/offers\", tags=[\"negotiations\"])$/", "language": "Python", "kind": "variable"}], "hash": "707379190588503023d2aa1c0d294bd5", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/negotiations.py", "fields": [{"name": "Optional[float] counter_amount", "scope": "NegotiationPostPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] message", "scope": "NegotiationPostPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/offers\", tags=[\"negotiations\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"103": ""}]}