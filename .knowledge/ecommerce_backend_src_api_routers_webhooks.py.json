{"is_source_file": true, "format": "Python", "description": "Source file defining FastAPI routes for handling payment webhooks. It includes a data model for webhook acknowledgment, functions to map webhook events to transaction statuses, and an endpoint to process payment provider webhook callbacks.", "external_files": ["src.deps", "src.models", "src.models.enums", "src.services.payments"], "external_methods": ["verify_webhook"], "published": [], "classes": [{"name": "WebhookAck", "description": "Pydantic model representing webhook acknowledgment payload, indicating receipt, verification status, optional action, transaction ID, and notes."}], "methods": [{"name": "tuple[Optional[str],Optional[TransactionStatus]] _map_stripe_event_to_status(event: Dict[str, Any])", "description": "Maps incoming Stripe-like webhook event types to the corresponding TransactionStatus and extracts the payment intent ID.", "scope": "", "scopeKind": ""}, {"name": "WebhookAck payments_webhook( request: Request, stripe_signature: str | None = Header(default=None, alias=\"Stripe-Signature\"), db: Session = Depends(db_session), )", "description": "FastAPI endpoint to handle incoming payment webhooks, verify signatures, update transaction statuses, and respond with acknowledgment.", "scope": "", "scopeKind": ""}], "calls": ["verify_webhook", "db.scalar", "select", "db.add", "db.flush"], "search-terms": ["webhook", "Stripe", "TransactionStatus", "payment_intent", "payment provider webhook"], "state": 2, "file_id": 45, "knowledge_revision": 122, "git_revision": "9f1e7421a7d3508686b7f7bd4a02ba62930e790f", "revision_history": [{"116": ""}, {"120": ""}, {"121": ""}, {"122": "9f1e7421a7d3508686b7f7bd4a02ba62930e790f"}], "ctags": [{"_type": "tag", "name": "WebhookAck", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^class WebhookAck(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_map_stripe_event_to_status", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^def _map_stripe_event_to_status(event: Dict[str, Any]) -> tuple[Optional[str], Optional[Transact/", "language": "Python", "typeref": "typename:tuple[Optional[str],Optional[TransactionStatus]]", "kind": "function", "signature": "(event: Dict[str, Any])"}, {"_type": "tag", "name": "action", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^    action: Optional[str] = Field(default=None, description=\"Action\\/status applied to the trans/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WebhookAck", "scopeKind": "class"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^    note: Optional[str] = Field(default=None, description=\"Additional notes\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WebhookAck", "scopeKind": "class"}, {"_type": "tag", "name": "payments_webhook", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^async def payments_webhook($/", "language": "Python", "typeref": "typename:WebhookAck", "kind": "function", "signature": "( request: Request, stripe_signature: str | None = Header(default=None, alias=\"Stripe-Signature\"), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "received", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^    received: bool = Field(..., description=\"Whether the webhook was received and processed\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "WebhookAck", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^router = APIRouter(prefix=\"\\/webhooks\", tags=[\"webhooks\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "transaction_id", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^    transaction_id: Optional[str] = Field(default=None, description=\"Transaction UUID affected (/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WebhookAck", "scopeKind": "class"}, {"_type": "tag", "name": "verified", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/webhooks.py", "pattern": "/^    verified: bool = Field(..., description=\"Whether the webhook payload signature was verified\"/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "WebhookAck", "scopeKind": "class"}], "hash": "672859c36e8924a8f75d9563aabbd892", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/webhooks.py", "fields": [{"name": "Optional[str] action", "scope": "WebhookAck", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] note", "scope": "WebhookAck", "scopeKind": "class", "description": "unavailable"}, {"name": "bool received", "scope": "WebhookAck", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/webhooks\", tags=[\"webhooks\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] transaction_id", "scope": "WebhookAck", "scopeKind": "class", "description": "unavailable"}, {"name": "bool verified", "scope": "WebhookAck", "scopeKind": "class", "description": "unavailable"}]}