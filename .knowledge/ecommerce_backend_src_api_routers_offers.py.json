{"is_source_file": true, "format": "Python", "description": "This file implements API endpoints for managing offers related to listings in an e-commerce backend. It includes routes for creating, listing, retrieving, countering, accepting, and declining offers, with appropriate authentication and authorization logic, as well as related data models and helper functions.", "external_files": ["src.core.security", "src.deps", "src.models", "src.models.enums", "src.schemas.offer"], "external_methods": ["decode_token", "db_session", "OfferRead.model_validate", "select", "and_", "or_", "select", "desc"], "published": ["create_offer_for_listing", "list_offers", "get_offer", "counter_offer", "accept_offer", "decline_offer"], "classes": [{"name": "_TokenUser", "description": "Internal helper schema to represent token-authenticated user identity for offers endpoints."}, {"name": "OfferCreatePayload", "description": "Schema for creating an offer on a listing, containing the amount."}, {"name": "OfferCounterPayload", "description": "Schema for countering an existing offer, containing the counter amount."}], "methods": [{"name": "_TokenUser _auth_user(authorization: str | None = Header(default=None))", "description": "Extracts current user UUID from Bearer token, raising 401 on errors.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_listing_active(listing: Listing)", "description": "Checks if a listing is active, raises 400 if inactive.", "scope": "", "scopeKind": ""}, {"name": "OfferRead create_offer_for_listing( id: UUID, payload: OfferCreatePayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Creates a new offer for a specific listing from the authenticated user.", "scope": "", "scopeKind": ""}, {"name": "List[OfferRead] list_offers( status: Optional[OfferStatus] = Query(default=None), listing_id: Optional[UUID] = Query(default=None), mine: bool = Query(default=False, description=\"Show only offers related to me\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )", "description": "Lists offers with optional filtering by status, listing, or user ownership.", "scope": "", "scopeKind": ""}, {"name": "OfferRead get_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Retrieves a specific offer by UUID, with access control.", "scope": "", "scopeKind": ""}, {"name": "Listing _ensure_can_modify_offer_as_seller(offer: Offer, token_user: _TokenUser, db: Session)", "description": "Checks if the seller can modify the offer, ensuring correct status and ownership.", "scope": "", "scopeKind": ""}, {"name": "OfferRead counter_offer( id: UUID, payload: OfferCounterPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows the seller to counter an offer by updating the amount.", "scope": "", "scopeKind": ""}, {"name": "OfferRead accept_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows buyer or seller to accept a pending offer.", "scope": "", "scopeKind": ""}, {"name": "OfferRead decline_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows buyer or seller to decline a pending offer.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "db_session", "OfferRead.model_validate", "select", "and_", "or_", "select", "desc"], "search-terms": ["offers", "router", "Offer", "negotiation", "listings", "counter", "accept", "decline", "offer status", "offer creation", "offer listing"], "state": 2, "file_id": 40, "knowledge_revision": 101, "git_revision": "", "ctags": [{"_type": "tag", "name": "OfferCounterPayload", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class OfferCounterPayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "OfferCreatePayload", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class OfferCreatePayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _auth_user(authorization: str | None = Header(default=None)) -> _TokenUser:$/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Header(default=None))"}, {"_type": "tag", "name": "_ensure_can_modify_offer_as_seller", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _ensure_can_modify_offer_as_seller(offer: Offer, token_user: _TokenUser, db: Session) -> Lis/", "language": "Python", "typeref": "typename:Listing", "kind": "function", "signature": "(offer: Offer, token_user: _TokenUser, db: Session)"}, {"_type": "tag", "name": "_ensure_listing_active", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _ensure_listing_active(listing: Listing) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(listing: Listing)"}, {"_type": "tag", "name": "accept_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def accept_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    amount: Decimal = Field(..., description=\"Counter offer amount\")$/", "language": "Python", "typeref": "typename:Decimal", "kind": "variable", "scope": "OfferCounterPayload", "scopeKind": "class"}, {"_type": "tag", "name": "amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    amount: Decimal = Field(..., description=\"Offer amount\")$/", "language": "Python", "typeref": "typename:Decimal", "kind": "variable", "scope": "OfferCreatePayload", "scopeKind": "class"}, {"_type": "tag", "name": "counter_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def counter_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, payload: OfferCounterPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "create_offer_for_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def create_offer_for_listing($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, payload: OfferCreatePayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "decline_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def decline_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "get_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def get_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "list_offers", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def list_offers($/", "language": "Python", "typeref": "typename:List[OfferRead]", "kind": "function", "signature": "( status: Optional[OfferStatus] = Query(default=None), listing_id: Optional[UUID] = Query(default=None), mine: bool = Query(default=False, description=\"Show only offers related to me\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^router = APIRouter(prefix=\"\\/offers\", tags=[\"offers\"])$/", "language": "Python", "kind": "variable"}], "hash": "ccfadae22b798c454023fea02a6ecb23", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/offers.py", "fields": [{"name": "Decimal amount", "scope": "OfferCounterPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/offers\", tags=[\"offers\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"101": ""}]}