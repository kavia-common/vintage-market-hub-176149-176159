{"is_source_file": true, "format": "Python (FastAPI)", "description": "This file implements the API endpoints related to 'offers' in an e-commerce backend, including creating offers, listing offers, retrieving specific offers, countering, accepting, and declining offers. It handles authentication, authorization, and database interactions for offer-related actions.", "external_files": ["src/core/security", "src.deps", "src.models", "src.models.enums", "src.schemas.offer"], "external_methods": ["decode_token", "db_session", "OfferRead.model_validate"], "published": ["router"], "classes": [{"name": "_TokenUser", "description": "Internal helper schema to represent token-authenticated user identity for offers endpoints."}, {"name": "OfferCreatePayload", "description": "Payload model for creating an offer."}, {"name": "OfferCounterPayload", "description": "Payload model for countering an offer."}], "methods": [{"name": "_TokenUser _auth_user(authorization: str | None = Header(default=None))", "description": "Extracts and validates the user UUID from the authorization token header.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_listing_active(listing: Listing)", "description": "Checks if a listing is active; raises exception if not.", "scope": "", "scopeKind": ""}, {"name": "OfferRead create_offer_for_listing( id: UUID, payload: OfferCreatePayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Creates a new offer on a listing, ensuring listing is active and user is not the seller.", "scope": "", "scopeKind": ""}, {"name": "List[OfferRead] list_offers( status: Optional[OfferStatus] = Query(default=None), listing_id: Optional[UUID] = Query(default=None), mine: bool = Query(default=False, description=\"Show only offers related to me\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )", "description": "Returns a list of offers with optional filters, including listing, status, and ownership.", "scope": "", "scopeKind": ""}, {"name": "OfferRead get_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Retrieves a specific offer by UUID, ensuring user is a party involved.", "scope": "", "scopeKind": ""}, {"name": "Listing _ensure_can_modify_offer_as_seller(offer: Offer, token_user: _TokenUser, db: Session)", "description": "Confirms the current user is the seller and the offer is modifiable.", "scope": "", "scopeKind": ""}, {"name": "OfferRead counter_offer( id: UUID, payload: OfferCounterPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows the seller to counter an existing offer by updating the amount.", "scope": "", "scopeKind": ""}, {"name": "OfferRead accept_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows buyer or seller to accept an offer if it's pending.", "scope": "", "scopeKind": ""}, {"name": "OfferRead decline_offer( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Allows buyer or seller to decline a pending offer.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "db_session", "OfferRead.model_validate", "select", "and_", "or_", "select", "db.get", "db.add", "db.flush", "db.refresh", "select", "or_", "and_", "desc"], "search-terms": ["offers", "create_offer_for_listing", "list_offers", "get_offer", "counter_offer", "accept_offer", "decline_offer", "offer status", "negotiation", "api router", "SQLAlchemy", "FastAPI", "offer endpoints"], "state": 2, "file_id": 40, "knowledge_revision": 106, "git_revision": "b07083c22ee65345050b202a97acab5dcf18f388", "revision_history": [{"101": ""}, {"106": "b07083c22ee65345050b202a97acab5dcf18f388"}], "ctags": [{"_type": "tag", "name": "OfferCounterPayload", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class OfferCounterPayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "OfferCreatePayload", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class OfferCreatePayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _auth_user(authorization: str | None = Header(default=None)) -> _TokenUser:$/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Header(default=None))"}, {"_type": "tag", "name": "_ensure_can_modify_offer_as_seller", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _ensure_can_modify_offer_as_seller(offer: Offer, token_user: _TokenUser, db: Session) -> Lis/", "language": "Python", "typeref": "typename:Listing", "kind": "function", "signature": "(offer: Offer, token_user: _TokenUser, db: Session)"}, {"_type": "tag", "name": "_ensure_listing_active", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def _ensure_listing_active(listing: Listing) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(listing: Listing)"}, {"_type": "tag", "name": "accept_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def accept_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    amount: Decimal = Field(..., description=\"Counter offer amount\")$/", "language": "Python", "typeref": "typename:Decimal", "kind": "variable", "scope": "OfferCounterPayload", "scopeKind": "class"}, {"_type": "tag", "name": "amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^    amount: Decimal = Field(..., description=\"Offer amount\")$/", "language": "Python", "typeref": "typename:Decimal", "kind": "variable", "scope": "OfferCreatePayload", "scopeKind": "class"}, {"_type": "tag", "name": "counter_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def counter_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, payload: OfferCounterPayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "create_offer_for_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def create_offer_for_listing($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, payload: OfferCreatePayload, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "decline_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def decline_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "get_offer", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def get_offer($/", "language": "Python", "typeref": "typename:OfferRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "list_offers", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^def list_offers($/", "language": "Python", "typeref": "typename:List[OfferRead]", "kind": "function", "signature": "( status: Optional[OfferStatus] = Query(default=None), listing_id: Optional[UUID] = Query(default=None), mine: bool = Query(default=False, description=\"Show only offers related to me\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/offers.py", "pattern": "/^router = APIRouter(prefix=\"\\/offers\", tags=[\"offers\"])$/", "language": "Python", "kind": "variable"}], "hash": "fc953607cbee47f241f0a74223c2f310", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/offers.py", "fields": [{"name": "Decimal amount", "scope": "OfferCounterPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/offers\", tags=[\"offers\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}