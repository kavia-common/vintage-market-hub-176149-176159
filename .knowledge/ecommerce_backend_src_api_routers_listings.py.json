{"is_source_file": true, "format": "Python", "description": "This file defines FastAPI routes for managing e-commerce listings, including listing retrieval, creation, update, deletion, and image upload. It includes dependencies for authentication, database interactions with SQLAlchemy, and route handlers with detailed summaries and descriptions.", "external_files": ["src.core.config", "src.deps", "src.models", "src.schemas.listing", "src.core.security"], "external_methods": ["decode_token", "db_session"], "published": ["list_listings", "get_listing", "create_listing", "update_listing", "delete_listing", "upload_listing_image_stub"], "classes": [{"name": "_TokenUser", "description": "Internal schema representing the authenticated user's UUID extracted from token."}], "methods": [{"name": "_TokenUser _get_current_user_id(authorization: str = Query(alias=\"Authorization\"))", "description": "Placeholder for extracting current user ID from an authorization token (not used directly in endpoints).", "scope": "", "scopeKind": ""}, {"name": "_TokenUser _auth_user(authorization: str | None = Depends(lambda Authorization=Depends(lambda Authorization=...): Authorization))", "description": "Dependency that authenticates the user via Bearer token, returning the user's UUID.", "scope": "", "scopeKind": ""}, {"name": "ListingRead create_listing( payload: ListingCreate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "None delete_listing( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ListingRead get_listing(id: UUID, db: Session = Depends(db_session))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[ListingRead] list_listings( search: Optional[str] = Query(default=None, description=\"Search text in title and description\"), region: Optional[UUID] = Query(default=None, description=\"Region id to filter\"), category: Optional[UUID] = Query(default=None, description=\"Category id to filter\"), price_min: Optional[Decimal] = Query(default=None, description=\"Minimum price\"), price_max: Optional[Decimal] = Query(default=None, description=\"Maximum price\"), sort: Optional[str] = Query(default=\"new\", description=\"Sort by: new | price_asc | price_desc\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(db_session), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ListingRead update_listing( id: UUID, payload: ListingUpdate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "dict upload_listing_image_stub( id: UUID, file: UploadFile = File(...), token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["select(Listing)", "Listing.title.ilike", "Listing.description.ilike", "Listing.region_id", "Listing.category_id", "Listing.price", "Listing.created_at", "db.get", "db.add", "db.flush", "db.refresh", "db.delete", "db_session", "decode_token", "get_settings"], "search-terms": ["listings", "list_listings", "listing endpoints", "get_listing", "create_listing", "update_listing", "delete_listing", "image upload", "listing filters", "listing response models", "listing creation"], "state": 2, "file_id": 39, "knowledge_revision": 95, "git_revision": "", "ctags": [{"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^async def _auth_user(authorization: str | None = Depends(lambda Authorization=Depends(lambda Aut/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Depends(lambda Authorization=Depends(lambda Authorization=...): Authorization))"}, {"_type": "tag", "name": "_get_current_user_id", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def _get_current_user_id(authorization: str = Query(alias=\"Authorization\")) -> _TokenUser:  # ac/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str = Query(alias=\"Authorization\"))"}, {"_type": "tag", "name": "create_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def create_listing($/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "( payload: ListingCreate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "delete_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def delete_listing($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "get_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def get_listing(id: UUID, db: Session = Depends(db_session)) -> ListingRead:$/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "(id: UUID, db: Session = Depends(db_session))"}, {"_type": "tag", "name": "list_listings", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def list_listings($/", "language": "Python", "typeref": "typename:List[ListingRead]", "kind": "function", "signature": "( search: Optional[str] = Query(default=None, description=\"Search text in title and description\"), region: Optional[UUID] = Query(default=None, description=\"Region id to filter\"), category: Optional[UUID] = Query(default=None, description=\"Category id to filter\"), price_min: Optional[Decimal] = Query(default=None, description=\"Minimum price\"), price_max: Optional[Decimal] = Query(default=None, description=\"Maximum price\"), sort: Optional[str] = Query(default=\"new\", description=\"Sort by: new | price_asc | price_desc\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^router = APIRouter(prefix=\"\\/listings\", tags=[\"listings\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def update_listing($/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "( id: UUID, payload: ListingUpdate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "upload_listing_image_stub", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def upload_listing_image_stub($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( id: UUID, file: UploadFile = File(...), token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}], "hash": "0a3005eac2e70e236fe7af75c1b40121", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/listings.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/listings\", tags=[\"listings\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"95": ""}]}