{"is_source_file": true, "format": "Python", "description": "This source file defines FastAPI routes related to 'listings' in an e-commerce backend. It includes endpoints for listing, retrieving, creating, updating, deleting, and uploading images for listings, along with associated helper functions and data models.", "external_files": ["src.core.config", "src.core.security", "src.deps", "src.models", "src.schemas.listing"], "external_methods": ["decode_token", "db_session"], "published": ["list_listings", "get_listing", "create_listing", "update_listing", "delete_listing", "upload_listing_image_stub"], "classes": [{"name": "_TokenUser", "description": "Internal helper schema to represent token-authenticated user identity for listings endpoints."}], "methods": [{"name": "_TokenUser _auth_user(authorization: str | None = Header(default=None))", "description": "Extracts current user UUID from Bearer access token, raising 401 on problems.", "scope": "", "scopeKind": ""}, {"name": "List[ListingRead] list_listings( search: Optional[str] = Query(default=None, description=\"Search text in title and description\"), region: Optional[UUID] = Query(default=None, description=\"Region id to filter\"), category: Optional[UUID] = Query(default=None, description=\"Category id to filter\"), price_min: Optional[Decimal] = Query(default=None, description=\"Minimum price\"), price_max: Optional[Decimal] = Query(default=None, description=\"Maximum price\"), sort: Optional[str] = Query(default=\"new\", description=\"Sort by: new | price_asc | price_desc\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(db_session), )", "description": "Returns a paginated list of listings applying provided filters and sorting.", "scope": "", "scopeKind": ""}, {"name": "ListingRead get_listing(id: UUID, db: Session = Depends(db_session))", "description": "Fetches a single listing by UUID.", "scope": "", "scopeKind": ""}, {"name": "ListingRead create_listing( payload: ListingCreate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Creates a new listing owned by the current user after validating related entities.", "scope": "", "scopeKind": ""}, {"name": "ListingRead update_listing( id: UUID, payload: ListingUpdate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Updates fields of an existing listing, ensuring the current user is the owner.", "scope": "", "scopeKind": ""}, {"name": "None delete_listing( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Deletes a listing, ensuring the current user is the owner.", "scope": "", "scopeKind": ""}, {"name": "dict upload_listing_image_stub( id: UUID, file: UploadFile = File(...), token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Stub endpoint for uploading an image for a listing; stores locally or returns a placeholder.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "db_session", "db.get", "db.add", "db.flush", "db.refresh", "db.delete", "ListingRead.model_validate", "Listing.model_validate", "get_settings"], "search-terms": ["listings", "Listing", "list_listings", "create_listing", "update_listing", "delete_listing", "upload_image", "listing endpoints", "search filters"], "state": 2, "file_id": 39, "knowledge_revision": 99, "git_revision": "da08be5b0c62063cc2823cc6d5f13bf729dc68f0", "revision_history": [{"95": ""}, {"98": "da08be5b0c62063cc2823cc6d5f13bf729dc68f0"}, {"99": "da08be5b0c62063cc2823cc6d5f13bf729dc68f0"}], "ctags": [{"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def _auth_user(authorization: str | None = Header(default=None)) -> _TokenUser:$/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Header(default=None))"}, {"_type": "tag", "name": "create_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def create_listing($/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "( payload: ListingCreate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "delete_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def delete_listing($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "get_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def get_listing(id: UUID, db: Session = Depends(db_session)) -> ListingRead:$/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "(id: UUID, db: Session = Depends(db_session))"}, {"_type": "tag", "name": "list_listings", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def list_listings($/", "language": "Python", "typeref": "typename:List[ListingRead]", "kind": "function", "signature": "( search: Optional[str] = Query(default=None, description=\"Search text in title and description\"), region: Optional[UUID] = Query(default=None, description=\"Region id to filter\"), category: Optional[UUID] = Query(default=None, description=\"Category id to filter\"), price_min: Optional[Decimal] = Query(default=None, description=\"Minimum price\"), price_max: Optional[Decimal] = Query(default=None, description=\"Maximum price\"), sort: Optional[str] = Query(default=\"new\", description=\"Sort by: new | price_asc | price_desc\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^router = APIRouter(prefix=\"\\/listings\", tags=[\"listings\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_listing", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def update_listing($/", "language": "Python", "typeref": "typename:ListingRead", "kind": "function", "signature": "( id: UUID, payload: ListingUpdate, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "upload_listing_image_stub", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/listings.py", "pattern": "/^def upload_listing_image_stub($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( id: UUID, file: UploadFile = File(...), token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}], "hash": "8be33325210843567aa6a327b12a7e70", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/listings.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/listings\", tags=[\"listings\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}