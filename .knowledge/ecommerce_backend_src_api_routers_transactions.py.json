{"is_source_file": true, "format": "Python", "description": "Source code defining API routes for managing transactions in an e-commerce backend, including checkout processing, listing transactions, and fetching specific transaction details.", "external_files": ["src/core/config", "src/core/security", "src.deps", "src.models", "src.models.enums", "src.schemas.transaction", "src.services.payments"], "external_methods": ["decode_token", "get_settings", "db_session", "create_payment_intent", "TransactionRead.model_validate"], "published": ["checkout", "list_transactions", "get_transaction"], "classes": [{"name": "_TokenUser", "description": "Internal helper schema to represent token-authenticated user identity for transactions."}, {"name": "CheckoutRequest", "description": "Schema for the request payload to initiate a payment checkout."}, {"name": "CheckoutResponse", "description": "Schema for the response payload containing payment intent info and transaction details."}], "methods": [{"name": "_TokenUser _auth_user(authorization: str | None = Header(default=None))", "description": "Extracts and verifies the user's UUID from the authorization token.", "scope": "", "scopeKind": ""}, {"name": "CheckoutResponse checkout( payload: CheckoutRequest, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Creates a payment intent and records a pending transaction.", "scope": "", "scopeKind": ""}, {"name": "List[TransactionRead] list_transactions( mine: bool = Query(default=False, description=\"Show only current user's transactions\"), status: Optional[TransactionStatus] = Query(default=None, description=\"Filter by transaction status\"), listing_id: Optional[UUID] = Query(default=None, description=\"Filter by listing id\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )", "description": "Returns a list of transactions, possibly filtered by ownership, status, or listing.", "scope": "", "scopeKind": ""}, {"name": "TransactionRead get_transaction( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )", "description": "Fetches a specific transaction by UUID, restricted to the buyer.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "create_payment_intent", "db.get", "db.add", "db.flush", "db.refresh", "TransactionRead.model_validate"], "search-terms": ["transactions API", "payment intent creation", "transaction listing", "transaction retrieval", "Buyer-only transaction access", "Stripe payment provider", "transaction status filter"], "state": 2, "file_id": 44, "knowledge_revision": 119, "git_revision": "", "revision_history": [{"114": ""}, {"119": ""}], "ctags": [{"_type": "tag", "name": "CheckoutRequest", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^class CheckoutRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "CheckoutResponse", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^class CheckoutResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_TokenUser", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^class _TokenUser(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_UUID", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    from uuid import UUID as _UUID$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_auth_user", "scopeKind": "function", "nameref": "unknown:UUID"}, {"_type": "tag", "name": "_auth_user", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^def _auth_user(authorization: str | None = Header(default=None)) -> _TokenUser:$/", "language": "Python", "typeref": "typename:_TokenUser", "kind": "function", "signature": "(authorization: str | None = Header(default=None))"}, {"_type": "tag", "name": "amount", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    amount: Decimal = Field(..., description=\"Total amount for the transaction\")$/", "language": "Python", "typeref": "typename:Decimal", "kind": "variable", "scope": "CheckoutRequest", "scopeKind": "class"}, {"_type": "tag", "name": "checkout", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^def checkout($/", "language": "Python", "typeref": "typename:CheckoutResponse", "kind": "function", "signature": "( payload: CheckoutRequest, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "client_secret", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    client_secret: Optional[str] = Field(default=None, description=\"Client secret for payment co/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "CheckoutResponse", "scopeKind": "class"}, {"_type": "tag", "name": "currency", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    currency: str = Field(default=\"USD\", min_length=3, max_length=3, description=\"Currency (ISO /", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "CheckoutRequest", "scopeKind": "class"}, {"_type": "tag", "name": "get_transaction", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^def get_transaction($/", "language": "Python", "typeref": "typename:TransactionRead", "kind": "function", "signature": "( id: UUID, token_user: _TokenUser = Depends(_auth_user), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "list_transactions", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^def list_transactions($/", "language": "Python", "typeref": "typename:List[TransactionRead]", "kind": "function", "signature": "( mine: bool = Query(default=False, description=\"Show only current user's transactions\"), status: Optional[TransactionStatus] = Query(default=None, description=\"Filter by transaction status\"), listing_id: Optional[UUID] = Query(default=None, description=\"Filter by listing id\"), authorization: str | None = Header(default=None), db: Session = Depends(db_session), )"}, {"_type": "tag", "name": "listing_id", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    listing_id: Optional[UUID] = Field(default=None, description=\"Listing being purchased (optio/", "language": "Python", "typeref": "typename:Optional[UUID]", "kind": "variable", "scope": "CheckoutRequest", "scopeKind": "class"}, {"_type": "tag", "name": "metadata", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    metadata: Optional[dict] = Field(default=None, description=\"Additional metadata to attach to/", "language": "Python", "typeref": "typename:Optional[dict]", "kind": "variable", "scope": "CheckoutRequest", "scopeKind": "class"}, {"_type": "tag", "name": "payment_intent_id", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    payment_intent_id: str = Field(..., description=\"Provider payment intent identifier\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "CheckoutResponse", "scopeKind": "class"}, {"_type": "tag", "name": "provider", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^    provider: str = Field(..., description=\"Payment provider used\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "CheckoutResponse", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/vintage-market-hub-176149-176159/ecommerce_backend/src/api/routers/transactions.py", "pattern": "/^router = APIRouter(prefix=\"\\/transactions\", tags=[\"transactions\"])$/", "language": "Python", "kind": "variable"}], "hash": "d08417154ebb2e9b221dfea36186eeab", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/api/routers/transactions.py", "fields": [{"name": "Decimal amount", "scope": "CheckoutRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] client_secret", "scope": "CheckoutResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str currency", "scope": "CheckoutRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[UUID] listing_id", "scope": "CheckoutRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[dict] metadata", "scope": "CheckoutRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str payment_intent_id", "scope": "CheckoutResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str provider", "scope": "CheckoutResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/transactions\", tags=[\"transactions\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}